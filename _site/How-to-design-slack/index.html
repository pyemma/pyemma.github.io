<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="How to Design Slack" /><meta name="author" content="Coding Monkey" /><meta property="og:locale" content="en" /><meta name="description" content="In this post, I would like to discuss how to build slack, a very popular realtime messaging application, especially for group messaging (a.k.a channel) in cooperation messaging scenario." /><meta property="og:description" content="In this post, I would like to discuss how to build slack, a very popular realtime messaging application, especially for group messaging (a.k.a channel) in cooperation messaging scenario." /><link rel="canonical" href="https://pyemma.github.io/How-to-design-slack/" /><meta property="og:url" content="https://pyemma.github.io/How-to-design-slack/" /><meta property="og:site_name" content="Coding Monkey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-01T00:00:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to Design Slack" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@pyemma" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Coding Monkey","url":"https://github.com/pyemma"},"dateModified":"2025-02-10T21:40:33-08:00","datePublished":"2025-02-01T00:00:00-08:00","description":"In this post, I would like to discuss how to build slack, a very popular realtime messaging application, especially for group messaging (a.k.a channel) in cooperation messaging scenario.","headline":"How to Design Slack","mainEntityOfPage":{"@type":"WebPage","@id":"https://pyemma.github.io/How-to-design-slack/"},"url":"https://pyemma.github.io/How-to-design-slack/"}</script><title>How to Design Slack | Coding Monkey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Coding Monkey"><meta name="application-name" content="Coding Monkey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/profile.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Coding Monkey</a></h1><p class="site-subtitle fst-italic mb-0">I’m a staff software engineer with rich experience in recommendation system and machine learning infrastructure. I spent my last 8 years in both Big-Tech (Meta & LinkedIn) and startups (Aven), and I’m glad to see if my past experience and learnings could help boost your career growth <br><br> <a href="https://bit.ly/41vi77B"><strong>book a session now</strong></a></p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/pyemma" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['pyemma1991','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>How to Design Slack</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>How to Design Slack</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1738396800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 1, 2025 </time> </span> <span> Updated <time data-ts="1739252433" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 10, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/pyemma">Coding Monkey</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3295 words" > <em>18 min</em> read</span></div></div><div style="text-align: right;"> <span> <a href="https://hitscounter.dev/api/hit?url=https%3A%2F%2Fpyemma.github.io%2F&label=&icon=github&color=%23198754&message=&style=flat&tz=UTC" class="popup img-link shimmer"><img src="https://hitscounter.dev/api/hit?url=https%3A%2F%2Fpyemma.github.io%2F&label=&icon=github&color=%23198754&message=&style=flat&tz=UTC" alt="Views" loading="lazy"></a> </span></div></div></header><div class="content"><p>In this post, I would like to discuss how to build slack, a very popular realtime messaging application, especially for group messaging (a.k.a channel) in cooperation messaging scenario.</p><h2 id="functional-requirements"><span class="me-2">Functional Requirements</span><a href="#functional-requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Channel messaging (group messaging) and thread message (reply to a message in a channel or DM)<li>Direct messaging (1 to 1 messaging)<li>Support sending message to both online and offline users</ol><h2 id="non-functional-requirements"><span class="me-2">Non Functional Requirements</span><a href="#non-functional-requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>High availability<li>High scalability<li>Low latency for realtime message delivery<li>Causal consistency for best user experience<li>At least once delivery semantic to avoid missing messages</ol><h2 id="assumption"><span class="me-2">Assumption</span><a href="#assumption" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>In this design, we would leave out the discussion how user would login and how user would join a channel. We assume that there is dedicated service to handle the user login verification, and user could join a channel via different approach such as invitation or search.<li>We would also simplify our discussion to persist user’s channel membership information. In reality, these information could be stored in a dedicated <code class="language-plaintext highlighter-rouge">channel_membership</code> table. Based on the read/write ratio, relational database such as MySQL or column database such as Cassandra could be adopted.<li>We would assume that the message would be persistent on the server side as well, instead of only storing them locally on client side. This is a legit use case for the cooperation scenario, but might not be an option for other scenarios. For example, WeChat and Whatsapp does not store the message on the backend side but just temporarily buffer them. Once the receiver is online and the message is delivered, the message on server side would be deleted.</ol><h2 id="key-challenges"><span class="me-2">Key Challenges</span><a href="#key-challenges" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>How does clients communicate with backend services<li>When one user send a message in a channel, how this message gets fan-out to other users in the same channel<li>How to guarantee the casual consistency within the channel messaging</ol><h2 id="high-level-design"><span class="me-2">High Level Design</span><a href="#high-level-design" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here is a high level design of Slack where we adopted a hierarchy broadcasting design. There are some alternative options with different trade off and we would discuss them shortly in the sections below.</p><p><a href="/assets/slack-dispatcher.png" class="popup img-link shimmer"><img src="/assets/slack-dispatcher.png" alt="Slack - Dispatcher Style" loading="lazy"></a></p><h3 id="client-connection"><span class="me-2">Client Connection</span><a href="#client-connection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Client (e.g. desktop client or mobile app) connects with our backend service via <strong>websocket</strong> connection, which is handled by the <code class="language-plaintext highlighter-rouge">Websocket Server</code>. There are different approaches for long live connection as well (short live connection is not very appropriate in this scenario due to large overhead on repeating building connections), e.g. <em>HTTP long polling</em>, <em>SSE</em>. However, realtime messaging is usually <strong>bidirectional communication</strong> and <strong>websocket</strong> would be good option in this scenario. Within each <code class="language-plaintext highlighter-rouge">Websocket Server</code>, there would be an event loop that is listening on the port it exposed, as well as an internal data structure to manage the channel and websocket connection relationship (a.k.a a subscription table, see example below). When <code class="language-plaintext highlighter-rouge">Websocket Server</code> receive message for a channel, the event loop would check this data structure to find the websocket connections that are subscribing this channel and the message would be handled to the websocket connection to delivery to the client.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span>
    <span class="c1"># channel_id: list[websocket_objects]
</span>    <span class="sh">'</span><span class="s">gongzuoqun_1</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">websocket_obj1</span><span class="p">,</span> <span class="n">websocket_obj2</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">gongzuoqun_2</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">websocket_obj1</span><span class="p">,</span> <span class="n">websocket_obj2</span><span class="p">,</span> <span class="n">websocket_obj3</span><span class="p">],</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After the user has login, the user would build connection with one <code class="language-plaintext highlighter-rouge">Websocket Server</code> and the selection of the server is handled by the <em>load balancer</em>. There could be some different strategy, such as round-robin routing, workload based routing, or even sticky routing if it is just a short-time disconnection. Once the connection is built, there are 2 important tasks that need to be done:</p><ol><li>Retrieve the channel information of the user from the <code class="language-plaintext highlighter-rouge">channel_table</code>, update internal subscription table, and send subscribe request to the <code class="language-plaintext highlighter-rouge">Channel Server</code> (to be expanded later)<li>Retrieve the message sent by others during the user is offline from the <code class="language-plaintext highlighter-rouge">message_table</code></ol><p>When user is offline, the <code class="language-plaintext highlighter-rouge">Websocket Server</code> would also update its internal subscription table. If for some channels there are no clients subscribing, the server could send a unsubscribe request to the <code class="language-plaintext highlighter-rouge">Channel Server</code> so that we could manage the workload and avoid unnecessary resource waste.</p><h3 id="message-delivery"><span class="me-2">Message Delivery</span><a href="#message-delivery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s first discuss the option to deliver channel message. There are 3 aspects that we need to discuss:</p><ol><li>How does user send message to the channel<li>How does other users receive the message that are sent to the channel<li>How does user receive message when the user has been offline for a while</ol><h3 id="how-does-user-send-message"><span class="me-2">How does user send message</span><a href="#how-does-user-send-message" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To send a message to a channel, there are two approaches: 1. use the websocket connection we have already established; 2. send it as a HTTP Post request to another <code class="language-plaintext highlighter-rouge">Web Server</code> (a.k.a functional sharding). Both of the choice are workable solution (Slack used the 2nd approach according to their <a href="https://slack.engineering/real-time-messaging/">blog</a>). Here is a quick comparison between the 2 options:</p><ul><li>The benefit of reusing websocket connection is minimized latency and reduced complexity on the infrastructure; however, the downside is that the websocket server needs to keep live connections with clients and would not be easily to horizontally scale based on the QPS of the traffic; also websocket requires customized retry logic when message sending is failed<li>The benefits of using HTTP Post request to send message is that it offers better horizontal scalability and native retry support; however, the downside is that the latency would be slightly higher and there is some more complexity on the infra</ul><p>Another practical consideration is the processing of the message. To make sure that we don’t lose any message, when our backend receive the message, we would first write it into the <code class="language-plaintext highlighter-rouge">Message DB</code> and then fan-out (or broadcast) the message to other users in the same channel. There would be additional business related logic need to run over the message such as validation. All of these process would put additional pressure on the host machine. Thus, it might be a legit option to have dedicated <code class="language-plaintext highlighter-rouge">Web Servers</code> to handle message write instead of reusing the <code class="language-plaintext highlighter-rouge">Websocket Server</code> to avoid putting too much load on them.</p><h4 id="how-does-other-users-receive-message"><span class="me-2">How does other users receive message</span><a href="#how-does-other-users-receive-message" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s first take a look at the channel messaging scenario. There are several options:</p><ul><li><em>Dispatcher</em>: In this option, we would have dedicated <code class="language-plaintext highlighter-rouge">Channel Servers</code> which play as a <em>dispatcher role</em> (I talked about this design in <a href="/How-to-design-auction-system/">my pervious post on how to design auction service</a>). Each channel service would handle a portion of channels (we will discuss this in scalability section) and maintains a subscription table similar to one in <code class="language-plaintext highlighter-rouge">Websocket Server</code> which records the <code class="language-plaintext highlighter-rouge">channel_id -&gt; websocket server id</code> information. This subscription table is updated by the request sent from <code class="language-plaintext highlighter-rouge">Websocket Servers</code>. Once the web server receive messages, it would send this message to the channel server the manage the channel and then the message would be broadcast the websocket servers that is subscribing to the channel.</ul><blockquote><p>You might ask why we need such a <code class="language-plaintext highlighter-rouge">Channel Server</code>, why not just use the <code class="language-plaintext highlighter-rouge">Websocket Server</code>? One reason is that the subscription table, which is a stateful information, is not easy to be directly maintained on <code class="language-plaintext highlighter-rouge">Websocket Server</code>; another one is to follow the <em>Single Responsibility Principle</em>; last but not the least, is that we could scale <code class="language-plaintext highlighter-rouge">Channel Server</code> and <code class="language-plaintext highlighter-rouge">Websocket Server</code> individually based on the number of channels and number of active users</p></blockquote><ul><li><p><em>Pub/Sub</em>: In this option, we would use message queue for pub/sub style message exchanging. For each channel, a dedicated topic would be created within the message queue. For the <code class="language-plaintext highlighter-rouge">Websocket Server</code> who is connected with the user in the channel, they would subscribe to the corresponding topic. Once message is published onto the topic, message queue would deliver the message to the <code class="language-plaintext highlighter-rouge">Websocket Server</code> who is subscribing. Note that we could choose a message queue that support poll or push mode: for poll mode, <code class="language-plaintext highlighter-rouge">Websocket Server</code> needs to periodically poll data from the queue; for push mode, message queue would be responsible for delivering message. Given the load and the realtime scenarios, adopting a <strong>in memory push mode message queue</strong> might be a good choice.</p><li><p><em>Fan-out</em> In this option, we maintain a queue similar to a inbox for each user, and the channel message would be fan-out written to this inbox. The exact choice of the inbox could be message queue (each user’s inbox is a topic) or database (each user’s inbox is a table). <code class="language-plaintext highlighter-rouge">Websocket Server</code> would periodically poll data from the inbox for new message. One benefits of this solution is a unified flow for both online and offline message delivery scenario. However, this solution would probably incur higher latency, as well as the causal inconsistency issue (because we have multiple copy of message stored for the same channel).</p></ul><p>We also need to consider how could be provide the <em>at least once</em> message delivery guarantee as we mentioned in the non functional requirements.</p><ul><li>When client send a message to a channel, if the HTTP post request failed, client side could retry it. With retry, there could be duplicated requests sent from client. We could adopt an <em>idempotency key</em> and <em>cache layer</em> so that the web server could dedup the already succeed post requests. In our design, each message needs to be written to <code class="language-plaintext highlighter-rouge">Message DB</code> first for persistent. Thus we could also use <code class="language-plaintext highlighter-rouge">upsert</code> when writing to DB to avoid writing duplicated message with the same <em>idempotency key</em>. This strategy is also applicable to the <em>Fan-out</em> option.<li>In the <em>Dispatcher</em> or <em>Pub/Sub</em> option, when <code class="language-plaintext highlighter-rouge">Web Server</code> forward messages to <code class="language-plaintext highlighter-rouge">Channel Server</code> and <code class="language-plaintext highlighter-rouge">Channel Server</code> broadcast messages to <code class="language-plaintext highlighter-rouge">Websocket Server</code>, we could also adopt retry until we receive ACK from the destination server. We could add a dedup on the client side when receive message from the websocket and allow <code class="language-plaintext highlighter-rouge">Web Server</code> or <code class="language-plaintext highlighter-rouge">Channel Server</code> to forward duplicated requests.</ul><p>In the remaining design, we would assume to use the <em>Dispatcher</em> option, which is also the option that Slack has deployed in production.</p><h4 id="how-to-receive-offline-message"><span class="me-2">How to receive offline message</span><a href="#how-to-receive-offline-message" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>If a user is offline, then he would miss the message that is broadcast by the <code class="language-plaintext highlighter-rouge">Channel Server</code>. To receive these messages, we need to leverage the <code class="language-plaintext highlighter-rouge">Message DB</code>. When a user is offline, we could store the timestamp as <code class="language-plaintext highlighter-rouge">last_active_time</code> in a dedicated table (e.g. <code class="language-plaintext highlighter-rouge">user_activity_table</code> or in <code class="language-plaintext highlighter-rouge">user_profile_table</code>); and when user is back online, we could retrieve the <code class="language-plaintext highlighter-rouge">last_active_time</code> and do a query in <code class="language-plaintext highlighter-rouge">Message DB</code> against all channel that user is in, pulling out all messages. Another option is to keep a client side snapshot of the local message status, and send it to server when user come back again; server would use the snapshot to compute the delta message the user is missing and send it back. Both of the solution has some drawback: the <code class="language-plaintext highlighter-rouge">last_active_time</code> solution requires additional DB write and also need the time within the fleet of machine is synchronized (e.g. NTP) or read more data backward; using snapshot would have some additional challenge when dealing with multi-device scenario.</p><p>One more thing to mention is that we need to appropriately synchronize offline message receiving and online message receiving when user is just back online. We should confirm that all the offline message is read and shown to user before showing the message from websocket in order to guarantee the causal consistency and good user experience.</p><h4 id="how-to-support-direct-messaging"><span class="me-2">How to support direct messaging</span><a href="#how-to-support-direct-messaging" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Direct messaging and channel messaging does not have too much difference, except that channel messaging is broadcasting to multiple users while direct messaging is “broadcasting” to only one users. However, it might be less efficient to let the <code class="language-plaintext highlighter-rouge">Channel Server</code> to forward the message. We could directly forward the message to the <code class="language-plaintext highlighter-rouge">Websocket Server</code> that the receipt user is connected. Which <code class="language-plaintext highlighter-rouge">Websocket Server</code> the user is connected to could be store in a in memory <strong>KV store</strong> for fast read/write. Another consideration is to treat it as <em>service discovery</em> and use some dedicated solution such as <strong>Zookeeper</strong> or <strong>Consul</strong>; but since user would online/offline pretty often, this could put a lot of write pressure for the distributed consensus.</p><h4 id="how-to-support-thread-message"><span class="me-2">How to support thread message</span><a href="#how-to-support-thread-message" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Thread message does not have a big difference compared with regular message. The only difference is that they are embedded within another message in channel. To support it, we could create a field in the <code class="language-plaintext highlighter-rouge">message_table</code> to indicate which message is its parent. And when we broadcast the message, we also include this information in the request payload.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">message_table</span>
<span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">channel_id</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">author_id</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">parent_message_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="n">content</span><span class="p">:</span> <span class="n">text</span>
<span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># message payload
</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">abc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">parent_message_id</span><span class="sh">"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1234</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="high-availability"><span class="me-2">High Availability</span><a href="#high-availability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s discuss about the high availability. We would skip the discussion on <code class="language-plaintext highlighter-rouge">Message DB</code> as the general rule of how to make DB fault tolerance is applicable (you could checkout my Youtube video <a href="https://www.youtube.com/watch?v=X8IhZx7fg24">here</a>).</p><p>For the <code class="language-plaintext highlighter-rouge">Websocket Server</code>, they are stateless and don’t need to persistent any data on the server. If one <code class="language-plaintext highlighter-rouge">Websocket Server</code> is dead, then all connections on that server would be lost. The clients need to reconnect with other <code class="language-plaintext highlighter-rouge">Websocket Server</code>. The new <code class="language-plaintext highlighter-rouge">Websocket Server</code> would also need to refresh the information stored in the <strong>KV store</strong> (could use last write win strategy) to make sure direct messaging could still work.</p><p>For the <code class="language-plaintext highlighter-rouge">Channel Server</code>, they are stateful as they need to maintain the subscription table so that channel message could be correctly broadcasted. First, this subscription table could be maintained locally on the host disk using WAL. If the process that responsible for forwarding the message crashes accidentally but the host is still alive, we could rebuild the subscription table quickly by reading the WAL. In the situation that the host is gone, we need to replicate the subscription table to somewhere else to make sure the message could still be broadcast. One option would be storing this information to KV store; another option is to directly replicate the subscription table to other <code class="language-plaintext highlighter-rouge">Channel Server</code>. In this option, we could have a single leader to handle all read/write request, and have multiple followers to store the replicated data. We also need a coordination service to help maintain the leader/follower information as well as the leader election.</p><p><a href="/assets/channel-server-replication.png" class="popup img-link shimmer"><img src="/assets/channel-server-replication.png" alt="Channel Server Replication" width="500" height="500" loading="lazy"></a></p><h2 id="high-scalability"><span class="me-2">High Scalability</span><a href="#high-scalability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The <code class="language-plaintext highlighter-rouge">Message DB</code> could be horizontally scaled. For sharding, there is key-range sharding and hash based sharding. Key-range sharding is not very suitable in this case. We could apply hash based sharing on the channel id, which should be able to relatively evenly distribute the message across all hosts. To support efficient query data for offline case, we could build index on timestamp column (since each channel’s message is co-locate on the same host, local secondary index is sufficient). Another consideration is to partition based on both channel id and the bucketed timestamp similar to <a href="https://discord.com/blog/how-discord-stores-billions-of-messages">how Discord store their data initially</a>.</p><p>The <code class="language-plaintext highlighter-rouge">Websocket Server</code> is relative simple to scale because they are stateless, we could add more servers if the network bandwidth is limited. The <code class="language-plaintext highlighter-rouge">Web Server</code> that handles the HTTP post requests for sending message could also be handled in the similar strategy.</p><p>The <code class="language-plaintext highlighter-rouge">Channel Server</code> could be scaled by horizontal scaling as well, to partition the <code class="language-plaintext highlighter-rouge">channel_id</code> and have each server to handle a portion of the channels. However, since we are dealing with realtime messaging scenario, it is pretty critical to minimize the latency during the time that one node is down or we add additional node into the cluster to handle more traffic. That is to say, minimizing the data we need to transfer during rebalancing is critical. Thus, adopting <strong>Consistent Hashing</strong> would be a great option here. Which server handles which range of ids on the <em>consistent ring</em> is a consensus that needs to be made among all servers. This could be achieved by running a <em>gossip protocol</em> among all servers or use a dedicated coordination service to manage this assignment information. The downsides of <em>gossip protocol</em> is that there would be some performance penalty when the number of nodes in the cluster is large; the cons of using coordination service is that we need to manage and maintain another service within our system.</p><blockquote class="prompt-info"><p>To figure out which <code class="language-plaintext highlighter-rouge">Channel Server</code> to send the message to, <code class="language-plaintext highlighter-rouge">Web Server</code> could first check the coordination service or any channel server to get the assignment information and cache it locally to reduce the volume of requests. Since this information is not changed that frequently, we could refresh this information on a cadence or use read-repair strategy (refresh the info when channel sever refused the request due to staled information)</p></blockquote><p>Although we use <strong>Consistent Hashing</strong> and <code class="language-plaintext highlighter-rouge">channel_id</code> to balance the data, there could still be unbalanced load on each server, especially when the number of physical node is relative small. We could consider using <strong>virtual node</strong> to make the data on each node more balanced; or consider manual configuration for some hotspot channel.</p><h2 id="causal-consistency"><span class="me-2">Causal Consistency</span><a href="#causal-consistency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In group messaging scenario, it is pretty critical to guarantee causal consistency; otherwise users in the group might see wired conversation. In our design, we could guarantee this with a single leader replication strategy. Since the message writing is first written to <code class="language-plaintext highlighter-rouge">Message DB</code> and then broadcast to users, and we shard the <code class="language-plaintext highlighter-rouge">message_table</code> based on <code class="language-plaintext highlighter-rouge">channel_id</code>, we could guarantee that the order of the message has and only has a single “version” and there would be no conflict. If we make db write and message broadcast async, then there would be teh case that the order we written to DB is not the same with the order we broadcast, and the causal consistency is break. One potential solution to support async DB write and message broadcasting is to associate a version vector to capture the causality among messages.</p><p><a href="/assets/causal-consistency-issue.png" class="popup img-link shimmer"><img src="/assets/causal-consistency-issue.png" alt="Causal Consistency Issue In Async DB Write Mode" loading="lazy"></a></p><h2 id="additional-functionalities"><span class="me-2">Additional Functionalities</span><a href="#additional-functionalities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We have finished the discussion on the majority part of the functionality, let’s have some light discussion on other functionality but going to deep.</p><ul><li>How to support online presence feature<ul><li>There are different options to implement this, in push mode or in poll mode. In the push mode, we could have a dedicated queue for each user to receive the online signal. When user is online, the client could send a active message periodically via the websocket and forward this message to all users’ friend (or is viewable in client); when user is offline, we could also send such a message to the queue to indicate that the user is offline. This online signal is similar to heartbeat that is widely used in distributed system. In poll mode, the <code class="language-plaintext highlighter-rouge">Websocket Server</code> could poll information from the coordination service where we store the <code class="language-plaintext highlighter-rouge">user id &lt;-&gt; websocket server id</code> info and use that to indicate if user is online.</ul><li>How to support *XXX is typing…**<ul><li>We could reuse the websocket and send a typing message to the <code class="language-plaintext highlighter-rouge">Websocket Server</code>, and then have this message to be broadcast by the <code class="language-plaintext highlighter-rouge">Channel Server</code>. Since this type of message does not need persistent, we don’t need to go through the <code class="language-plaintext highlighter-rouge">Web Server</code> for simplicity.</ul><li>How to support global service<ul><li>To support global service, we could deploy the <code class="language-plaintext highlighter-rouge">Websocket Server</code> to each global region and have user connect to the region that is closet to them. The <code class="language-plaintext highlighter-rouge">Channel Server</code> could be in a dedicated region to have the single leader setup. But we could also consider multi leader setup to further scale, with the drawback of write conflicts in some cases.</ul><li>How to support Slack emoji<ul><li>Emoji could be treated as a special type of thread message. We could reuse the data schema defined for thread message, by adding a <code class="language-plaintext highlighter-rouge">message_type</code> field with enum type such as <code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">emoji</code>.</ul></ul><blockquote class="prompt-tip"><p>If you find this post helpful, feel free to scan the QR code below to support me and treat me to a cup of coffee</p></blockquote><p><a href="/assets/qr%20code.png" class="popup img-link shimmer"><img src="/assets/qr%20code.png" alt="Thank You" width="300" height="300" loading="lazy"></a></p><h2 id="reference"><span class="me-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li><a href="https://cloud.tencent.com/developer/article/2232218">从0到1：微信后台系统的演进之路</a><li><a href="https://slack.engineering/real-time-messaging/">Real-time Messaging</a><li><a href="https://medium.com/@joudwawad/redis-pub-sub-in-depth-d2c6f4334826">Redis Pub/Sub In-Depth</a><li><a href="https://discord.com/blog/how-discord-stores-billions-of-messages">How Discord Stores Billions of Messages</a><li><a href="https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html">Cassandra - Dynamo - Virtual Node</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/distributed-system/">Distributed System</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >distributed system</a> <a href="/tags/stateful-service/" class="post-tag no-text-decoration" >stateful service</a> <a href="/tags/websocket/" class="post-tag no-text-decoration" >websocket</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How%20to%20Design%20Slack%20-%20Coding%20Monkey&url=https%3A%2F%2Fpyemma.github.io%2FHow-to-design-slack%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How%20to%20Design%20Slack%20-%20Coding%20Monkey&u=https%3A%2F%2Fpyemma.github.io%2FHow-to-design-slack%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fpyemma.github.io%2FHow-to-design-slack%2F&text=How%20to%20Design%20Slack%20-%20Coding%20Monkey" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/Book-PyTorch-Training-Optimization/">PyTorch 性能与显存优化手册</a><li class="text-truncate lh-lg"> <a href="/Long-User-Sequence-Modeling-In-Recsys/">Recommendation System - Long User Sequence Modeling</a><li class="text-truncate lh-lg"> <a href="/Machine-Learning-System-Design-Sparse-Features/">Trend of Sparse Features in Recommendation System</a><li class="text-truncate lh-lg"> <a href="/Recsys-Paper-Review-2025-Q1/">Recsys Paper Summary 2025 Q1</a><li class="text-truncate lh-lg"> <a href="/How-to-design-slack/">How to Design Slack</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/machine-learning-design/">machine learning design</a> <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a> <a class="post-tag btn btn-outline-primary" href="/tags/distributed-system/">distributed system</a> <a class="post-tag btn btn-outline-primary" href="/tags/embeddings/">embeddings</a> <a class="post-tag btn btn-outline-primary" href="/tags/llm/">llm</a> <a class="post-tag btn btn-outline-primary" href="/tags/message-queue/">message queue</a> <a class="post-tag btn btn-outline-primary" href="/tags/realtime-system/">realtime system</a> <a class="post-tag btn btn-outline-primary" href="/tags/recommendation-system/">recommendation-system</a> <a class="post-tag btn btn-outline-primary" href="/tags/sparse-features/">sparse features</a> <a class="post-tag btn btn-outline-primary" href="/tags/stateful-service/">stateful service</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/How-to-design-online-chess-game/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1728543600" data-df="ll" > Oct 10, 2024 </time><h4 class="pt-0 my-2">How to Design Online Chess Game</h4><div class="text-muted"><p>I have been a fan of online game since my parent bought me a PC when I was in 5th grade. I could still feel the excitement when every Thursday night I rushed home and played DaHuaXiYou 2 with my fr...</p></div></div></a></article><article class="col"> <a href="/Flyte-How-Workflow-Get-Scheduled/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1726124400" data-df="ll" > Sep 12, 2024 </time><h4 class="pt-0 my-2">How Workflow Get Scheduled via Plugins in Flyte</h4><div class="text-muted"><p>Reading open source code has been a recommended approach for software engineers to learn. However, in my past 8 years career, I didn’t do a good job on that. After working in a startup for 1 year, ...</p></div></div></a></article><article class="col"> <a href="/Book-Pattern-of-Distributed-System/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720162800" data-df="ll" > Jul 5, 2024 </time><h4 class="pt-0 my-2">读书笔记 - Patterns of Distributed System</h4><div class="text-muted"><p>最近读了一本和 distributed system 相关的书籍，介绍了在 distributed system 里面常用的一些 pattern. 这是一篇简要的读书笔记，把书中提到的几个 pattern 总结了下来; 我计划会经常更新这篇 blog, 把我新学习到的或者总结出来的一些 pattern 记录在这里; 希望能起到一个引导性的作用，给大家提供一个提纲挈领的思路 Patterns...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/Recsys-2024-Paper-Summary/" class="btn btn-outline-primary" aria-label="Older" ><p>Recsys 2024 Paper Summary</p></a> <a href="/Recsys-Paper-Review-2025-Q1/" class="btn btn-outline-primary" aria-label="Newer" ><p>Recsys Paper Summary 2025 Q1</p></a></nav><div id="disqus_thread"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://pyemma.github.io/How-to-design-slack/'; this.page.identifier = '/How-to-design-slack/'; };var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://pyemma.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.getElementById('disqus_thread'));function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.getElementById('mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/pyemma">Coding Monkey</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/machine-learning-design/">machine learning design</a> <a class="post-tag btn btn-outline-primary" href="/tags/system-design/">system design</a> <a class="post-tag btn btn-outline-primary" href="/tags/distributed-system/">distributed system</a> <a class="post-tag btn btn-outline-primary" href="/tags/embeddings/">embeddings</a> <a class="post-tag btn btn-outline-primary" href="/tags/llm/">llm</a> <a class="post-tag btn btn-outline-primary" href="/tags/message-queue/">message queue</a> <a class="post-tag btn btn-outline-primary" href="/tags/realtime-system/">realtime system</a> <a class="post-tag btn btn-outline-primary" href="/tags/recommendation-system/">recommendation-system</a> <a class="post-tag btn btn-outline-primary" href="/tags/sparse-features/">sparse features</a> <a class="post-tag btn btn-outline-primary" href="/tags/stateful-service/">stateful service</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script src="/assets/js/data/mathjax.js"></script> <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-M1GM2SJR6M"></script> <script> document.addEventListener('DOMContentLoaded', function (event) { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-M1GM2SJR6M'); }); </script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
